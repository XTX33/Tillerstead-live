{% assign summary = include.summary | default: page.services_summary | default: 'Every project begins with precise layout, flood-tested waterproofing, and photo documentation suitable for lenders, tenants, or GCs. No shortcuts. No sliver tiles unless the plan leaves no alternative. TCNA-compliant, NJ HIC-licensed.' %}
{% assign services = include.services | default: page.services | default: site.data.services.services %}
{% assign services_gallery = include.gallery | default: page.services_gallery %}
{% assign section_id = include.section_id | default: 'ts-services' %}
{% assign heading_id = include.heading_id | default: section_id | append: '-title' %}

{%- comment -%}
  CORE CAPABILITIES section for Tillerstead homepage.
  Supports:
  - String format: "paint|Title|Description|/url|Tagline|Details"
  - Object format: { "icon": "...", "title": "...", "description": "...", "url": "...", "tagline": "...", "details": "..." }
{%- endcomment -%}

<section class="ts-services ts-section" id="{{ section_id }}" aria-labelledby="{{ heading_id }}" style="background-image: url('/assets/img/patterns/grid-tile-light.svg'); background-size: 240px 240px; background-position: center; background-attachment: fixed;">
  <div class="container">
    <header class="ts-services__header">
      <p class="eyebrow text-accent">TCNA-compliant layouts &amp; waterproof tile assemblies</p>
      <h2 id="{{ heading_id }}" class="heading-2 text-primary">
        Tile installations engineered for longevity, compliance, and visual precision.
      </h2>
      <p class="lead">{{ summary }}</p>
    </header>

    {% if services and services != empty %}
      <ul class="ts-services__grid" role="list">
        {% for raw in services %}
          {%- assign service_tagline = raw.tagline -%}
          {%- assign service_details = raw.details | default: raw.points -%}

          {%- if raw contains '|' -%}
            {%- assign parts = raw | split: '|' -%}
            {%- assign service_icon_key   = parts[0] | strip -%}
            {%- assign service_title      = parts[1] | strip -%}
            {%- assign service_description= parts[2] | strip -%}
            {%- assign service_url        = parts[3] | strip -%}
            {%- if parts.size &gt; 4 -%}
              {%- assign service_tagline = parts[4] | strip -%}
            {%- endif -%}
            {%- if parts.size &gt; 5 -%}
              {%- assign service_details = parts[5] | strip -%}
            {%- endif -%}
          {%- else -%}
            {%- assign service_icon_key   = raw.icon -%}
            {%- assign service_title      = raw.title -%}
            {%- assign service_description= raw.description -%}
            {%- assign service_url        = raw.url -%}
          {%- endif -%}

          {%- assign service_details_list = service_details -%}
          {%- if service_details_list and service_details_list contains '|' -%}
            {%- assign service_details_list = service_details_list | split: '|' -%}
          {%- elsif service_details_list and service_details_list contains ';' -%}
            {%- assign service_details_list = service_details_list | split: ';' -%}
          {%- elsif service_details_list and service_details_list contains ',' -%}
            {%- assign service_details_list = service_details_list | split: ',' -%}
          {%- endif -%}

          <li class="fade-in-scroll">
            {% include ts-service-card.html
              icon=service_icon_key
              title=service_title
              description=service_description
              tagline=service_tagline
              details=service_details_list
              url=service_url %}
          </li>
        {% endfor %}
      </ul>
    {% endif %}

    <nav class="ts-services__actions" aria-label="Service actions">
      <a class="btn btn--primary" href="{{ '/contact/' | relative_url }}">Request a TCNA-compliant waterproofing walkthrough</a>
      <a class="btn btn--ghost" href="{{ '/portfolio/' | relative_url }}">See documented installs &amp; technical details</a>
    </nav>

    <p class="ts-services__note">
      All work meets or exceeds TCNA 2024 standards. Daily documentation, transparent communication, and NJ HIC compliance from demolition to punch-list.
    </p>

    {% if services_gallery %}
      <div class="ts-services__gallery" aria-label="Recent tile work examples">
        {% for photo in services_gallery %}
          {% assign webp_src = photo.src | replace: '.jpg', '.webp' | replace: '.png', '.webp' %}
          <figure class="ts-services__photo">
            <picture>
              {% if webp_src %}
                <source type="image/webp" srcset="{{ webp_src | relative_url }}">
              {% endif %}
              <img src="{{ photo.src | relative_url }}"
                   alt="{{ photo.alt | default: 'Detail of TCNA-compliant tile installation in New Jersey' }}"
                   {% if photo.width and photo.height %}width="{{ photo.width }}" height="{{ photo.height }}"{% endif %}
                   loading="lazy" decoding="async"
                   sizes="(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 33vw">
            </picture>
            {% if photo.caption %}
              <figcaption>{{ photo.caption }}</figcaption>
            {% endif %}
          </figure>
        {% endfor %}
      </div>
    {% else %}
      <div class="ts-services__gallery" aria-label="Recent tile work examples">
        <figure class="ts-services__photo">
          <picture>
            <source type="image/webp" srcset="{{ '/assets/img/tillerstead-work/bathrooms/bathroom-wall-tile-detail-pre-grout.webp' | relative_url }}">
            <img src="{{ '/assets/img/tillerstead-work/bathrooms/bathroom-wall-tile-detail-pre-grout.jpg' | relative_url }}"
                 alt="Bathroom wall tile installation with TCNA-compliant waterproofing and substrate prep" loading="lazy" decoding="async">
          </picture>
          <figcaption>Large-format tile bathroom: precision layout, waterproof substrate, and TCNA-compliant installation (NJ HIC #13VH10808800).</figcaption>
        </figure>

        <figure class="ts-services__photo">
          <picture>
            <img src="{{ '/assets/img/tillerstead-work/bathrooms/after-lft-vanity-wall.jpg' | relative_url }}"
                 alt="Finished large-format tile vanity wall by Tillerstead LLC" loading="lazy" decoding="async">
          </picture>
          <figcaption>Finished bathroom: large-format tile with professional trim work and code-compliant installation.</figcaption>
        </figure>

        <figure class="ts-services__photo ts-services__photo--rotate">
          <picture>
            <source type="image/webp" srcset="{{ '/assets/img/tillerstead-work/bathrooms/large-format-tile-installation.webp' | relative_url }}">
            <img src="{{ '/assets/img/tillerstead-work/bathrooms/large-format-tile-installation.jpg' | relative_url }}"
                 alt="Large-format tile installation in progress with leveling system" loading="lazy" decoding="async">
          </picture>
          <figcaption>Installation process: leveling clips ensure lippage control and flat surfaces per TCNA standards.</figcaption>
        </figure>

        <figure class="ts-services__photo ts-services__photo--rotate">
          <picture>
            <img src="{{ '/assets/img/tillerstead-work/bathrooms/after-entry-shot.jpg' | relative_url }}"
                 alt="Completed bathroom tile installation by Tillerstead LLC, NJ licensed contractor" loading="lazy" decoding="async">
          </picture>
          <figcaption>Completed project: code-compliant bathroom tile with waterproofing and professional finish.</figcaption>
        </figure>
      </div>
    {% endif %}
  </div>
</section>
