{%- comment -%}
Breadcrumb Navigation Component
- Minimal, modern styling with emerald accent
- Schema.org BreadcrumbList for SEO
- Hidden on:
  - Home page
  - Root-level single pages (e.g. /about/, /contact.html)
  - When `breadcrumb: false` is set in front matter
{%- endcomment -%}

{%- assign is_home_page = page.url == "/" or page.url == "/index.html" or page.is_home == true or page.layout == "home" -%}

{%- comment -%}
  Normalize path and count non-empty segments.
  Examples:
  - "/"             → segment_count = 0
  - "/index.html"   → segment_count = 0
  - "/about/"       → segment_count = 1  (root-level page → no breadcrumbs)
  - "/contact.html" → segment_count = 1  (root-level page → no breadcrumbs)
  - "/pages/about/" → segment_count = 2  (nested page → show breadcrumbs)
{%- endcomment -%}
{%- assign path = page.url | default: '' | replace: 'index.html', '' -%}
{%- assign segments = path | split: '/' -%}
{%- assign segment_count = 0 -%}
{%- for segment in segments -%}
  {%- unless segment == '' -%}
    {%- assign segment_count = segment_count | plus: 1 -%}
  {%- endunless -%}
{%- endfor -%}
{%- assign is_root_leaf = segment_count <= 1 -%}

{%- if is_home_page or is_root_leaf or page.breadcrumb == false -%}
  {%- comment -%}Breadcrumbs hidden on home, root-level pages, or when disabled{%- endcomment -%}
{%- else -%}
  {%- assign clean_segments = '' | split: '' -%}
  {%- for segment in segments -%}
    {%- unless segment == '' -%}
      {%- assign clean_segments = clean_segments | push: segment -%}
    {%- endunless -%}
  {%- endfor -%}

  <nav class="breadcrumbs" aria-label="Breadcrumb" role="navigation">
    <ol class="breadcrumbs-list"
        itemscope
        itemtype="https://schema.org/BreadcrumbList">

      {%- assign position = 1 -%}

      <!-- Home breadcrumb -->
      <li class="breadcrumb-item"
          itemprop="itemListElement"
          itemscope
          itemtype="https://schema.org/ListItem">
        <a itemprop="item"
           href="{{ '/' | relative_url }}"
           class="breadcrumb-link">
          <span itemprop="name">Home</span>
        </a>
        <meta itemprop="position" content="{{ position }}">
      </li>

      {%- assign position = position | plus: 1 -%}
      {%- assign current_path = "" -%}

      <!-- Path segment breadcrumbs -->
      {%- for segment in clean_segments -%}
        {%- assign current_path = current_path | append: "/" | append: segment -%}
        {%- assign is_last = forloop.last -%}

        {%- if is_last -%}
          {%- assign label = page.breadcrumb_title | default: page.title | default: segment | replace: '-', ' ' | capitalize -%}
        {%- else -%}
          {%- assign label = segment | replace: '-', ' ' | capitalize -%}
        {%- endif -%}

        {%- assign crumb_href = current_path | append: "/" | relative_url -%}

        <li class="breadcrumb-item"
            itemprop="itemListElement"
            itemscope
            itemtype="https://schema.org/ListItem">
          <a itemprop="item"
             href="{{ crumb_href }}"
             class="breadcrumb-link"
             {% if is_last %}aria-current="page"{% endif %}>
            <span itemprop="name">{{ label }}</span>
          </a>
          <meta itemprop="position" content="{{ position }}">
        </li>

        {%- assign position = position | plus: 1 -%}
      {%- endfor -%}

    </ol>
  </nav>
{%- endif -%}