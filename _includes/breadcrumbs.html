{%- comment -%}
Breadcrumb Navigation Component

• Uses Schema.org BreadcrumbList (in markup wrapper).
• Hidden on:
  – Home page
  – Root-level single pages (e.g. /about/, /contact.html)
  – When `breadcrumb: false` is set in front matter
{%- endcomment -%}

{%- assign url = page.url | default: "/" -%}
{%- assign is_home_page = url == "/" or url == "/index.html" or page.is_home == true or page.layout == "home" -%}

{%- comment -%}
Normalize path and count non-empty segments.
Examples:
  "/"            → 0
  "/index.html"  → 0
  "/about/"      → 1 (root-level → no breadcrumbs)
  "/contact.html"→ 1 (root-level → no breadcrumbs)
  "/pages/about/ → 2 (nested → show breadcrumbs)
{%- endcomment -%}

{%- assign path = url | replace: 'index.html', '' -%}
{%- assign segments = path | split: '/' -%}
{%- assign segment_count = 0 -%}
{%- for segment in segments -%}
  {%- unless segment == '' -%}
    {%- assign segment_count = segment_count | plus: 1 -%}
  {%- endunless -%}
{%- endfor -%}

{%- assign is_root_leaf = segment_count <= 1 -%}

{%- if is_home_page or is_root_leaf or page.breadcrumb == false -%}
  {#-- No breadcrumbs rendered on home or root-level pages --#}
{%- else -%}
  {%- assign clean_segments = '' | split: '' -%}
  {%- for segment in segments -%}
    {%- unless segment == '' -%}
      {%- assign clean_segments = clean_segments | push: segment -%}
    {%- endunless -%}
  {%- endfor -%}

  <nav class="ts-breadcrumbs" aria-label="Breadcrumb">
    <ol class="ts-breadcrumbs__list" itemscope itemtype="https://schema.org/BreadcrumbList">
      {%- assign position = 1 -%}
      <li class="ts-breadcrumbs__item" itemprop="itemListElement" itemscope
          itemtype="https://schema.org/ListItem">
        <a class="ts-breadcrumbs__link" href="{{ '/' | relative_url }}" itemprop="item">
          <span itemprop="name">Home</span>
        </a>
        <meta itemprop="position" content="{{ position }}">
      </li>
      {%- assign position = position | plus: 1 -%}

      {%- assign current_path = "" -%}
      {%- for segment in clean_segments -%}
        {%- assign current_path = current_path | append: "/" | append: segment -%}
        {%- assign is_last = forloop.last -%}

        {%- if is_last -%}
          {%- assign label = page.breadcrumb_title | default: page.title | default: segment | replace: '-', ' ' | capitalize -%}
        {%- else -%}
          {%- assign label = segment | replace: '-', ' ' | capitalize -%}
        {%- endif -%}

        {%- assign crumb_href = current_path | append: "/" | relative_url -%}
        <li class="ts-breadcrumbs__item" itemprop="itemListElement" itemscope
            itemtype="https://schema.org/ListItem">
          {%- if is_last -%}
            <span class="ts-breadcrumbs__current" aria-current="page" itemprop="name">{{ label }}</span>
          {%- else -%}
            <a class="ts-breadcrumbs__link" href="{{ crumb_href }}" itemprop="item">
              <span itemprop="name">{{ label }}</span>
            </a>
          {%- endif -%}
          <meta itemprop="position" content="{{ position }}">
        </li>
        {%- assign position = position | plus: 1 -%}
      {%- endfor -%}
    </ol>
  </nav>
{%- endif -%}